#!/bin/bash

for i in \
  .bashrc \
  .bash_aliases \
  .zshrc \
  .vimrc \
  .tigrc \
  .tmux.conf
do
  if [ ! -s $HOME/$i ]
  then
    ln -s $PWD/$i $HOME/$i
  fi
done
if [ ! -d $HOME/.emacs.d ]
then
  mkdir $HOME/.emacs.d
fi
if [ ! -s $HOME/.emacs.d/init.el ]
then
  ln -s $PWD/.emacs.d_init.el $HOME/.emacs.d/init.el
fi
if [ ! -d $HOME/.lein ]
then
  mkdir $HOME/.lein
fi
if [ ! -f $HOME/.lein/profiles.clj ]
then
  cp $PWD/.lein_profiles.clj $HOME/.lein/profiles.clj
fi
if [ `which git` ]
then
  if [ ! -f $HOME/.gitignore ]
  then
    ln -s $PWD/.gitignore-global $HOME/.gitignore
  fi
  git config --global user.name ka
  git config --global user.email ka.kaosf@gmail.com
  git config --global core.editor vim
  git config --global core.excludesfile $HOME/.gitignore
  git config --global color.ui true
  git config --global github.user kaosf
  git config --global merge.ff false
  git config --global pull.rebase true
  git config --global alias.br branch
  git config --global alias.ci commit
  git config --global alias.co checkout
  git config --global alias.st status
  if [ ! -f $HOME/local/bin/diff-highlight ]
  then
    wget https://raw.githubusercontent.com/git/git/34d9819e0a387be6d49cffe67458036450d6d0d5/contrib/diff-highlight/diff-highlight
    LINENUMBER=`grep 'use strict;' diff-highlight -n | cut -d : -f 1`
    cat diff-highlight | head -$LINENUMBER > diff-highlight-1
    echo 'use Encode qw(decode_utf8 encode_utf8);' >> diff-highlight-1
    cat diff-highlight | tail -n +$(($LINENUMBER+1)) >> diff-highlight-1
    sed 's/push @removed, $_;/push @removed, decode_utf8($_);/' diff-highlight-1 | \
    sed 's/push @added, $_;/push @added, decode_utf8($_);/' | \
    sed 's/print $rm;/print encode_utf8($rm);/' | \
    sed 's/print @queue;/print encode_utf8($_) for @queue;/' > diff-highlight-2
    rm diff-highlight-1
    mv diff-highlight-2 diff-highlight
    chmod +x diff-highlight
    mkdir -p $HOME/local/bin
    mv diff-highlight $HOME/local/bin
  fi
  git config --global pager.log 'diff-highlight | less'
  git config --global pager.show 'diff-highlight | less'
  git config --global pager.diff 'diff-highlight | less'
  git config --global push.default simple
fi
if [ ! -s $HOME/.lesskey ]
then
  ln -s $PWD/.lesskey $HOME/.lesskey
  lesskey
fi
